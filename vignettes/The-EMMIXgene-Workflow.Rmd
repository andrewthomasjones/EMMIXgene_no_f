---
title: "EMMIX-gene"
author: "Andrew Jones"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: bibliography.bib
vignette: >
    %\VignetteIndexEntry{EMMIX-gene}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

# EMMIX-gene 
The aim of this document is to reproduce the results of the original EMMIX-gene paper (@mclachlan2002mixture) while demonstrating the EMMIX-gene R-package workflow.

## Data
The original paper analysed two data sets. The Golub Data was a dataset containing the centred and normalised values of the logged expression values of a subset of 3731 genes taken from @golub1999molecular. The Alon data was a dataset containing the centred and normalised values of the logged expression values of a subset of 2000 genes taken from @alon1999broad. The method of subset selection for both datasets follows that of their original papers and is described in @mclachlan2002mixture.

#Setup 
Unfortunately the original data used in the paper was not easily available, however this provides an opportunity to recreate the analysis using Bioconductor tools, which is also the purpose of this package. 

The raw Alon and Golub data are available in the 'colonCA' and 'golubEsets' Bioconductor packages respectively. 
Basic data pre-processing was peformed with vsn @vsn2002 for purpose of these examples:


```{r, recho=F, cache=TRUE}
library(EMMIXgene)
library(Biobase)
library(vsn)
set.seed(123)

data(colonCA, package = 'colonCA')
alon_data<-(Biobase::exprs(vsn::vsn2(colonCA)))

data(Golub_Merge, package = 'golubEsets')
golub_data<-(Biobase::exprs(vsn::vsn2(Golub_Merge)))

```

## Single Genes

Figures 1 to 3 in  (@mclachlan2002mixture) are reproduced here using the function plot_single_gene(). Due to the limitations with the original data mentioned earlier, the same genes could not be used and the scale is different. 
```{r, fig.show='hold', cache=T}
plot_single_gene(alon_data,1758, min =4, max=12)
plot_single_gene(alon_data,474,g=3, min =4, max=12)
plot_single_gene(alon_data, 474, g=2, min =4, max=12)
```


## Select Genes

The method of selecting genes isas in section 5.1 in (@mclachlan2002mixture) is performed using the function select_genes(). We find that 431 genes were selected, which compares well to 446 genes in the original analysis.

```{r, echo=F, cache=TRUE}
alon_sel<-select_genes(alon_data)
n_alon<-sum(alon_sel$selected)
```

Ways to work with
broadly similar

```{r, fig.show='hold', echo=FALSE, results='hide', cache=TRUE, message='hide'}
alon_top_n<-top_genes_cluster_tissues(alon_sel, n_alon, method='mfa', q=6, g=2)
heat_maps(alon_sel$all_genes[alon_top_n$top_genes,], alon_top_n$clustering)
cat(c("C1: ", c(which(alon_top_n$clustering==1)),"\n"))
cat(c("C2: ", c(which(alon_top_n$clustering==0)),"\n"))
```


```{r, fig.show='hold', echo=FALSE, results='hide', cache=TRUE, message='hide'}
alon_top_50<-top_genes_cluster_tissues(alon_sel, 12, method='mfa', q=6, g=2)
heat_maps(alon_sel$all_genes[alon_top_50$top_genes,], alon_top_50$clustering)
cat(c("C1: ", paste(which(alon_top_50$clustering==1)),"\n"))
cat(c("C2: ", paste(which(alon_top_50$clustering==0)),"\n"))
```


#5.1.2

```{r, echo=F,  cache=TRUE,message='hide'}
groups<-4
alon_clus_5 <- cluster_genes(alon_sel, groups)
alon_clus_5_t1<-all_cluster_tissues(gen=alon_sel, clusters=alon_clus_5, q=2, G=2)
alon_clus_5_t2<-cluster_tissues(alon_sel, alon_clus_5, method='t')
alon_clus_5_t3<-cluster_tissues(alon_sel, alon_clus_5, method='mfa', q=1, G=2)
cat(c("C1: ", paste(which(alon_clus_5_t1==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t1==0)),"\n"))

```


```{r, echo=F, fig.show='hold'}
j=1
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```

```{r, echo=F, fig.show='hold'}
j=2
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```

```{r, echo=F, fig.show='hold'}
j=3
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```


```{r, echo=F, fig.show='hold'}
j=4
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```


5.1.3
```{r, echo=F,  cache=TRUE, message='hide'}
cat(c("C1: ", paste(which(alon_clus_5_t1==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t1==0)),"\n"))
```



## Select Genes

In the case of the Golub data the same limitations mentioned earlier mean it is difficult to reproduce the original analysis exactly. This issue has been noted before [here](https://web.stanford.edu/~hastie/CASI_files/DATA/leukemia.html).

5.2 in in  (@mclachlan2002mixture)
```{r, cache=TRUE}
golub_sel<-select_genes(golub_data)
```



```{r, echo=F,  cache=TRUE,message='hide'}
groups<-40
golub_clus_10 <- cluster_genes(golub_sel, groups)
golub_clus_10_t1<-all_cluster_tissues(gen=golub_sel, clusters=golub_clus_10, q=6, G=2)

golub_clus_10_t2<-cluster_tissues(golub_sel, golub_clus_10, method='t')
golub_clus_10_t3<-cluster_tissues(golub_sel, golub_clus_10, method='mfa', q=6)
```


```{r, echo=F, fig.show='hold'}
j=1
plot<-heat_maps(golub_sel$genes[golub_clus_10==j,], golub_clus_10_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(golub_clus_10_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(golub_clus_10_t3[j,]==0)),"\n"))
```

```{r, echo=F, fig.show='hold'}
j=2
plot<-heat_maps(golub_sel$genes[golub_clus_10==j,], golub_clus_10_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(golub_clus_10_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(golub_clus_10_t3[j,]==0)),"\n"))
```

```{r, echo=F, fig.show='hold'}
j=3
plot<-heat_maps(golub_sel$genes[golub_clus_10==j,], golub_clus_10_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(golub_clus_10_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(golub_clus_10_t3[j,]==0)),"\n"))
```


```{r, echo=F,cache=TRUE, message='hide'}
groups<-10
golub_clus_10 <- cluster_genes(golub_sel, groups)
golub_clus_10_t1<-all_cluster_tissues(gen=golub_sel, clusters=golub_clus_10, q=5, G=2)
golub_clus_10_t2<-cluster_tissues(golub_sel, golub_clus_10, method='t')
golub_clus_10_t3<-all_cluster_tissues(gen=golub_sel, clusters=golub_clus_10, q=3, G=3)
```


```{r, echo=F, fig.show='hold'}
cat(c("C1: ", paste(which(golub_clus_10_t1==1)),"\n"))
cat(c("C2: ", paste(which(golub_clus_10_t1==0)),"\n"))
```

```{r, echo=F, results='hide', fig.show='hold'}
golub_top_50<-top_genes_cluster_tissues(golub_sel, 50, method='mfa', q=8, g=2)
heat_maps(golub_sel$all_genes[golub_top_50$top_genes,], golub_top_50$clustering)
cat(c("C1: ", paste(which(golub_top_50$clustering==0)),"\n"))
cat(c("C2: ", paste(which(golub_top_50$clustering==1)),"\n"))

```

```{r, echo=F, fig.show='hold'}
cat(c("C1: ", paste(which(golub_clus_10_t3==0)),"\n"))
cat(c("C2: ", paste(which(golub_clus_10_t3==1)),"\n"))
cat(c("C3: ", paste(which(golub_clus_10_t3==2)),"\n"))
```


# References