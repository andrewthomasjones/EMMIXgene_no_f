---
title: "EMMIX-gene"
author: "Andrew Jones"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
bibliography: bibliography.bib
csl: harvard-bournemouth-university.csl
vignette: >
    %\VignetteIndexEntry{EMMIX-gene}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---
```{r,  echo=F, include=F}
knitr::opts_chunk$set(fig.width=6, fig.height=4)
library(EMMIXgene)
```
# EMMIX-gene
The aim of this document is to reproduce the results of the original EMMIX-gene paper (@mclachlan2002mixture) while demonstrating the EMMIX-gene R-package workflow.

## Data
The original paper analysed two data sets. The Golub Data was a dataset containing the centred and normalised values of the logged expression values of a subset of 3731 genes taken from @golub1999molecular. The Alon data was a dataset containing the centred and normalised values of the logged expression values of a subset of 2000 genes taken from @alon1999broad. The method of subset selection for both datasets follows that of their original papers and is described in @mclachlan2002mixture. The raw Alon and Golub data are also available in the 'colonCA' and 'golubEsets' Bioconductor packages respectively.

## Single Genes

Figures 1 to 3 in  (@mclachlan2002mixture) are reproduced here using the function plot_single_gene().

```{r, fig.show='hold', cache=T}
plot_single_gene(alon_data,1758)
plot_single_gene(alon_data,474,g=3)
plot_single_gene(alon_data, 474, g=2)
```


## Select Genes

The method of selecting genes isas in section 5.1 in (@mclachlan2002mixture) is performed using the function select_genes(). We find that approximately 500 genes were selected, which compares well to 446 genes in the original analysis.

```{r, echo=F, cache=TRUE}
alon_sel<-select_genes(alon_data)
n_alon<-sum(alon_sel$selected)
```

The top genes can then be clustered using mixtures of common factor analysers.

```{r, fig.show='hold', echo=FALSE, results='hide', cache=TRUE, message='hide'}
alon_top_n<-top_genes_cluster_tissues(alon_sel, n_alon, method='mfa', q=6, g=2)
heat_maps(alon_sel$all_genes[alon_top_n$top_genes,], alon_top_n$clustering)
cat(c("C1: ", c(which(alon_top_n$clustering==1)),"\n"))
cat(c("C2: ", c(which(alon_top_n$clustering==0)),"\n"))
```


```{r, fig.show='hold', echo=FALSE, results='hide', cache=TRUE, message='hide'}
alon_top_50<-top_genes_cluster_tissues(alon_sel, 12, method='mfa', q=6, g=2)
heat_maps(alon_sel$all_genes[alon_top_50$top_genes,], alon_top_50$clustering)
cat(c("C1: ", paste(which(alon_top_50$clustering==1)),"\n"))
cat(c("C2: ", paste(which(alon_top_50$clustering==0)),"\n"))
```


#5.1.2
The tissues can then  also be clustered using either mixtures of t distributions or mixtures of common factor analysers.
```{r, echo=F,  cache=TRUE,message='hide'}
groups<-4
alon_clus_5 <- cluster_genes(alon_sel, groups)
alon_clus_5_t1<-all_cluster_tissues(gen=alon_sel, clusters=alon_clus_5, q=2, G=2)
alon_clus_5_t2<-cluster_tissues(alon_sel, alon_clus_5, method='t')
alon_clus_5_t3<-cluster_tissues(alon_sel, alon_clus_5, method='mfa', q=1, G=2)
cat(c("C1: ", paste(which(alon_clus_5_t1==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t1==0)),"\n"))

```

Heat maps similar to those in @mclachlan2002mixture can also be produced for each of the groups.

```{r, echo=F, fig.show='hold'}
j=1
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```

```{r, echo=F, fig.show='hold'}
j=2
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```

```{r, echo=F, fig.show='hold'}
j=3
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```


```{r, echo=F, fig.show='hold'}
j=4
plot<-heat_maps(alon_sel$genes[alon_clus_5==j,], alon_clus_5_t3[j,], paste0("Genes from Group G",j))
print(plot)
cat(c("C1: ", paste(which(alon_clus_5_t3[j,]==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t3[j,]==0)),"\n"))
```


5.1.3
```{r, echo=F,  cache=TRUE, message='hide'}
cat(c("C1: ", paste(which(alon_clus_5_t1==1)),"\n"))
cat(c("C2: ", paste(which(alon_clus_5_t1==0)),"\n"))
```


# References